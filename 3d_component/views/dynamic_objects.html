<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Three.js dynamic objects</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="js/three.min.js"></script>
		<script src="js/threex.domevents.js"></script>
		<script>

			var Width = window.innerWidth;
			var Height = window.innerHeight;
			// Our Javascript will go here.
			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera( 75, Width/Height, 0.1, 100000 );

			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( Width, Height );
			document.body.appendChild( renderer.domElement );

    		//img.map.needsUpdate = true;
    		var backimg = new THREE.MeshBasicMaterial({ map:THREE.ImageUtils.loadTexture('background.jpg')
    		});
        	// plane    	
        	var backgroundplane = new THREE.Mesh(new THREE.PlaneGeometry(32000, 20000),backimg);
        	var cube = new THREE.Mesh(new THREE.BoxGeometry(100,300,300), new THREE.MeshNormalMaterial({color: 0x0f00f0}));

        	backgroundplane.overdraw = true;
        	backgroundplane.position.z = -8000;

        	scene.add(backgroundplane);
        	scene.add(cube);

        	cube.posision.x = 0;
        	cube.position.y = 0;
        	cube.position.z = 0;
			camera.position.y = 0;
			camera.position.z = 700;
			camera.rotation.x = 0;

			//add 3 points light
			(function(){
			// add a ambient light
				var light	= new THREE.AmbientLight( 0x020202 );
				light.position.set(300, 100, -200);
				scene.add( light );
				// add a light in front
				var light	= new THREE.DirectionalLight('white', 1);
				light.position.set(500, 500, 200);
				scene.add( light );
				// add a light behind
				var light	= new THREE.DirectionalLight('white', 0.75);
				light.position.set(-500, -500, 200);
				scene.add( light );	
			})()

			//init domEvents
			var domEvents	= new THREEx.DomEvents(camera, renderer.domElement);

			THREEx.DomEvents.eventNames.forEach(function(eventName){
				if( eventName === 'mousemove' )	return
					domEvents.addEventListener(cube, eventName, function(event){
					var domElement	= document.querySelector('#logs');
					domElement.innerHTML = event.type + '<br/>' + domElement.innerHTML;
					}, false);
			});
	

			var mouse	= {x : 0, y : 0};
			document.addEventListener('mousemove', function(event){
				mouse.x	= (event.clientX / window.innerWidth )-0.5;
				mouse.y	= (event.clientY / window.innerHeight)-0.5;
			}, false);
			var onRenderFcts= [];
			onRenderFcts.push(function(delta, now){
				camera.position.x += 30*(mouse.x*200 - camera.position.x) * (delta*3);
				camera.position.y += 30*(mouse.y*200 - camera.position.y) * (delta*3);
				camera.lookAt( scene.position );
			});
			// render the scene
			onRenderFcts.push(function(){
				renderer.render( scene, camera );		
			});

			//loop runner
			var lastTimeMsec= null;
			requestAnimationFrame(function animate(nowMsec){
				// keep looping
				requestAnimationFrame( animate );
				// measure time
				lastTimeMsec	= lastTimeMsec || nowMsec-1000/60;
				var deltaMsec	= Math.min(200, nowMsec - lastTimeMsec);
				lastTimeMsec	= nowMsec;
				// call each update function
				onRenderFcts.forEach(function(onRenderFct){
					onRenderFct(deltaMsec/1000, nowMsec/1000);
				});
			});

			var render = function () {
				requestAnimationFrame( render );
				renderer.render(scene, camera);
			};

			render();
		</script>
		
	</body>
</html>