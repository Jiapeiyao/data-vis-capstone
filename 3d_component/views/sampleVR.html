<html>
	<head>
		<title>Three.js Cube</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="js/three.min.js"></script>
		<script src="js/StereoEffect.js"></script>
 		 <script src="js/DeviceOrientationControls.js"></script>
  		<script src="js/OrbitControls.js"></script>
		<script>

			//init scene
			var scene = new THREE.Scene();

			//init camera
			var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );
			camera.position.y = -450;
			camera.position.z = 400;
			camera.rotation.x = 0.75;
			scene.add(camera);

			//set up renderer
			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
  			var element = renderer.domElement;
  			// var container = document.getElementById('webglviewer');
  			// container.appendChild(element);
			document.body.appendChild( element );

			//set up StereoEffect
			var effect = new THREE.StereoEffect(renderer);
			effect.setSize( window.innerWidth, window.innerHeight );

			//set up camera control

	// 		var controls = new THREE.DeviceOrientationControls(camera, true);
  	// 		controls.connect();
  	// 		controls.update();
  	// 		element.addEventListener('click', fullscreen, false);
  	// 		window.removeEventListener('deviceorientation', setOrientationControls, true);
			var controls = new THREE.OrbitControls(camera, element);
  			controls.target.set(
    			camera.position.x + 0.15,
    			camera.position.y,
    			camera.position.z
  			);
  			controls.enablePan = false;
  			controls.enableZoom = false;
  			window.addEventListener('deviceorientation', setOrientationControls, true);
			function setOrientationControls(e) {
    			if (!e.alpha) 
      				return;
    		}

    		//add mouse control
    		var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;
    		var mouseX = 0, mouseY = 0;
    		document.addEventListener( 'mousemove', onDocumentMouseMove, false );
    		function onDocumentMouseMove(event) {

				mouseX = ( event.clientX - windowHalfX ) * 10;
				mouseY = ( event.clientY - windowHalfY ) * 10;

			}

    		//resize
    		window.addEventListener( 'resize', onWindowResize, false );
    		function onWindowResize() {

				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );
				effect.setSize( window.innerWidth, window.innerHeight );

			}

			//add objects
			var geometry = new THREE.BoxGeometry( 200, 200, 200 );
			var material = new THREE.MeshNormalMaterial();
			var cube = new THREE.Mesh( geometry, material );
			scene.add( cube );

			 var plane = new THREE.Mesh(new THREE.PlaneGeometry(300, 300), new THREE.MeshNormalMaterial());
			scene.add(plane);

			backimg = new THREE.MeshBasicMaterial({ map:THREE.ImageUtils.loadTexture('background.jpg')});
				backImage = new THREE.Mesh(new THREE.PlaneGeometry(320, 200),backimg);
				backImage.overdraw = true;
        		backImage.position.z = -80;
        		scene.add(backImage);

   			function onWindowResize() {

				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );
				effect.setSize( window.innerWidth, window.innerHeight );

			}


			var render = function () {
				requestAnimationFrame( render );

				

				cube.rotation.x += 0.1;
				cube.rotation.y += 0.1;
				plane.rotation.y += 0.03;

				effect.render(scene, camera);
			};

			render();
		</script>
	</body>
</html>